{
    "sourceFile": "src/pages/Brackets.svelte",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1763988789808,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763988799221,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -97,9 +97,9 @@\n     \r\n     <!-- Header -->\r\n     <div class=\"flex justify-between items-center mb-3\">\r\n       <div>\r\n-        <a href=\"/groups\" class=\"text-gray-400 hover:text-cyber-green transition-colors mb-1 inline-block text-xs flex items-center gap-1\">\r\n+        <a href={`/tournament/${tournamentId}/groups`} class=\"text-gray-400 hover:text-cyber-green transition-colors mb-1 inline-block text-xs flex items-center gap-1\">\r\n           <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"/></svg>\r\n           Back\r\n         </a>\r\n         <h1 class=\"text-xl font-black gradient-text flex items-center gap-1.5\">\r\n"
                },
                {
                    "date": 1763989554332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,10 @@\n <script lang=\"ts\">\r\n   import { onMount } from 'svelte';\r\n   import { getState, submitBracketWinner } from '$lib/api';\r\n \r\n-  let bracketMatches = $state([]) as any[];\r\n-  let players = $state([]) as any[];\r\n+  let { tournamentId } = $props<{ tournamentId: string }>();\r\n+\r\n   let tournamentState = $state('');\r\n   let champion = $state(null) as any;\r\n \r\n   async function loadState() {\r\n"
                },
                {
                    "date": 1764018886314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,10 @@\n   import { getState, submitBracketWinner } from '$lib/api';\r\n \r\n   let { tournamentId } = $props<{ tournamentId: string }>();\r\n \r\n+  let bracketMatches = $state([]) as any[];\r\n+  let players = $state([]) as any[];\r\n   let tournamentState = $state('');\r\n   let champion = $state(null) as any;\r\n \r\n   async function loadState() {\r\n@@ -50,16 +52,16 @@\n   async function handleWinner(matchId: string, winnerId: string) {\r\n       if (!winnerId) return;\r\n       console.log('Selecting winner:', { matchId, winnerId });\r\n       try {\r\n-        await submitBracketWinner(matchId, winnerId);\r\n+        await submitBracketWinner(tournamentId, matchId, winnerId);\r\n         console.log('Winner submitted successfully');\r\n         await loadState();\r\n         console.log('State reloaded, bracketMatches:', bracketMatches.length);\r\n-      } catch (error) {\r\n-        console.error('Error selecting winner:', error);\r\n-      }\r\n-  }\r\n+       } catch (error) {\r\n+         console.error('Error selecting winner:', error);\r\n+       }\r\n+   }\r\n \r\n   function getRounds() {\r\n       const rounds = [...new Set(bracketMatches.map(m => m.round))].sort((a, b) => a - b);\r\n       return rounds;\r\n"
                },
                {
                    "date": 1764023007383,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -125,12 +125,12 @@\n           <!-- Trophy and Celebration -->\r\n           <div class=\"text-center mb-4\">\r\n             <div class=\"relative inline-block\">\r\n               <svg class=\"w-16 h-16 mx-auto mb-2 text-yellow-400 drop-shadow-lg\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n-              CHAMPION\r\n-            </h2>\r\n-            <div class=\"text-xl font-black text-white mb-1\">{champion.name}</div>\r\n-            <div class=\"text-cyber-green text-sm font-bold\">{champion.points} Points</div>\r\n+                <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/>\r\n+              </svg>\r\n+              <!-- Confetti effect -->\r\n+              <div class=\"absolute -top-2 -left-2 w-20 h-20 pointer-events-none\">\r\n           </div>\r\n         </div>\r\n       {/if}\r\n       \r\n"
                }
            ],
            "date": 1763988789808,
            "name": "Commit-0",
            "content": "<script lang=\"ts\">\r\n  import { onMount } from 'svelte';\r\n  import { getState, submitBracketWinner } from '$lib/api';\r\n\r\n  let bracketMatches = $state([]) as any[];\r\n  let players = $state([]) as any[];\r\n  let tournamentState = $state('');\r\n  let champion = $state(null) as any;\r\n\r\n  async function loadState() {\r\n    const data = await getState(tournamentId);\r\n    // With $state, direct assignment triggers reactivity\r\n    bracketMatches = data.bracketMatches;\r\n    players = data.players;\r\n    tournamentState = data.state;\r\n\r\n    // Find champion (winner of finals)\r\n    const final = bracketMatches.find(m => m.bracketType === 'finals');\r\n    if (final?.winnerId) {\r\n      champion = players.find(p => p.id === final.winnerId);\r\n    }\r\n  }\r\n\r\n  function getPlayerName(id: string) {\r\n    if (!id) return 'TBD';\r\n    return players.find(p => p.id === id)?.name || 'Unknown';\r\n  }\r\n\r\n  function getPlayer(id: string) {\r\n    return players.find(p => p.id === id);\r\n  }\r\n  \r\n  function getRunnerUp() {\r\n    const final = bracketMatches.find(m => m.bracketType === 'finals');\r\n    if (final?.winnerId) {\r\n      const loserId = final.player1Id === final.winnerId ? final.player2Id : final.player1Id;\r\n      return players.find(p => p.id === loserId);\r\n    }\r\n    return null;\r\n  }\r\n  \r\n  function getThirdPlace() {\r\n    const thirdPlaceMatch = bracketMatches.find(m => m.bracketType === '3rd-place');\r\n    if (thirdPlaceMatch?.winnerId) {\r\n      return players.find(p => p.id === thirdPlaceMatch.winnerId);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async function handleWinner(matchId: string, winnerId: string) {\r\n      if (!winnerId) return;\r\n      console.log('Selecting winner:', { matchId, winnerId });\r\n      try {\r\n        await submitBracketWinner(matchId, winnerId);\r\n        console.log('Winner submitted successfully');\r\n        await loadState();\r\n        console.log('State reloaded, bracketMatches:', bracketMatches.length);\r\n      } catch (error) {\r\n        console.error('Error selecting winner:', error);\r\n      }\r\n  }\r\n\r\n  function getRounds() {\r\n      const rounds = [...new Set(bracketMatches.map(m => m.round))].sort((a, b) => a - b);\r\n      return rounds;\r\n  }\r\n\r\n  function getMatchesForRound(round: number) {\r\n      return bracketMatches.filter(m => m.round === round);\r\n  }\r\n\r\n  function getRoundLabel(round: number, totalRounds: number) {\r\n    const roundMatches = getMatchesForRound(round);\r\n    const hasThirdPlace = roundMatches.some(m => m.bracketType === '3rd-place');\r\n    \r\n    // Check bracket types in this round\r\n    if (roundMatches.some(m => m.bracketType === 'finals')) {\r\n      return 'Finals';\r\n    }\r\n    if (roundMatches.some(m => m.bracketType === 'semifinals')) {\r\n      return 'Semifinals';\r\n    }\r\n    if (roundMatches.some(m => m.bracketType === 'quarterfinals')) {\r\n      return 'Quarterfinals';\r\n    }\r\n    if (hasThirdPlace) {\r\n      return '3rd Place';\r\n    }\r\n    return `Round ${round}`;\r\n  }\r\n\r\n  onMount(loadState);\r\n</script>\r\n\r\n<div class=\"min-h-screen bg-gradient-to-br from-space-900 via-space-800 to-space-900 text-gaming-text px-3 py-3\">\r\n  <div class=\"max-w-[1800px] mx-auto\">\r\n    \r\n    <!-- Header -->\r\n    <div class=\"flex justify-between items-center mb-3\">\r\n      <div>\r\n        <a href=\"/groups\" class=\"text-gray-400 hover:text-cyber-green transition-colors mb-1 inline-block text-xs flex items-center gap-1\">\r\n          <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"/></svg>\r\n          Back\r\n        </a>\r\n        <h1 class=\"text-xl font-black gradient-text flex items-center gap-1.5\">\r\n          <svg class=\"w-5 h-5 text-yellow-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/></svg>\r\n          PLAYOFFS BRACKET\r\n        </h1>\r\n      </div>\r\n    </div>\r\n\r\n    {#if tournamentState !== 'playoffs'}\r\n      <div class=\"glass rounded-lg p-8 text-center\">\r\n        <svg class=\"w-12 h-12 mx-auto mb-3 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>\r\n        <p class=\"text-base text-gray-400 mb-1\">Playoffs have not started yet</p>\r\n        <p class=\"text-gray-500 text-xs\">Complete the group stage to generate brackets</p>\r\n      </div>\r\n    {:else}\r\n      \r\n      <!-- Champion Podium -->\r\n      {#if champion}\r\n        <div class=\"glass rounded-lg p-4 mb-3 text-center relative overflow-hidden\">\r\n          <div class=\"absolute inset-0 bg-gradient-to-r from-yellow-500/10 via-yellow-400/10 to-yellow-500/10\"></div>\r\n          <div class=\"relative z-10\">\r\n            <svg class=\"w-8 h-8 mx-auto mb-2 text-yellow-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/></svg>\r\n            <h2 class=\"text-lg font-black mb-1 bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-500 bg-clip-text text-transparent\">\r\n              CHAMPION\r\n            </h2>\r\n            <div class=\"text-xl font-black text-white mb-1\">{champion.name}</div>\r\n            <div class=\"text-cyber-green text-sm font-bold\">{champion.points} Points</div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n      \r\n      <!-- Runner-up -->\r\n      {#if getRunnerUp()}\r\n        {@const runnerUp = getRunnerUp()}\r\n        <div class=\"glass rounded-lg p-3 mb-3 text-center relative overflow-hidden\">\r\n          <div class=\"absolute inset-0 bg-gradient-to-r from-gray-400/10 via-gray-300/10 to-gray-400/10\"></div>\r\n          <div class=\"relative z-10\">\r\n            <svg class=\"w-6 h-6 mx-auto mb-1 text-gray-300\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/></svg>\r\n            <h2 class=\"text-sm font-black mb-1 text-gray-300\">\r\n              2ND PLACE\r\n            </h2>\r\n            <div class=\"text-base font-black text-white\">{runnerUp.name}</div>\r\n            <div class=\"text-gray-400 text-xs font-bold\">{runnerUp.points} Points</div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n      \r\n      <!-- 3rd Place Winner -->\r\n      {#if getThirdPlace()}\r\n        {@const thirdPlace = getThirdPlace()}\r\n        <div class=\"glass rounded-lg p-3 mb-3 text-center relative overflow-hidden\">\r\n          <div class=\"absolute inset-0 bg-gradient-to-r from-orange-500/10 via-orange-400/10 to-orange-500/10\"></div>\r\n          <div class=\"relative z-10\">\r\n            <svg class=\"w-6 h-6 mx-auto mb-1 text-orange-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\"/></svg>\r\n            <h2 class=\"text-sm font-black mb-1 text-orange-400\">\r\n              3RD PLACE\r\n            </h2>\r\n            <div class=\"text-base font-black text-white\">{thirdPlace.name}</div>\r\n            <div class=\"text-cyber-pink text-xs font-bold\">{thirdPlace.points} Points</div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <div class=\"space-y-6\">\r\n        \r\n        <!-- Playoff Bracket -->\r\n        <div class=\"glass rounded-lg p-3\">\r\n          <div class=\"flex items-center gap-2 mb-3\">\r\n            <div class=\"w-1 h-4 bg-gradient-to-b from-cyber-green to-cyber-blue rounded-full\"></div>\r\n            <h2 class=\"text-base font-black text-white\">PLAYOFF BRACKET</h2>\r\n            <div class=\"text-xs px-2 py-0.5 bg-cyber-green/20 text-cyber-green rounded-full font-bold\">Single Elimination</div>\r\n          </div>\r\n          \r\n          <div class=\"relative\">\r\n            <div class=\"flex gap-4 overflow-x-auto pb-2\">\r\n              {#each getRounds() as round, roundIndex}\r\n                {@const roundMatches = getMatchesForRound(round)}\r\n                {@const totalRounds = getRounds().length}\r\n                <div class=\"flex-shrink-0 w-64 flex flex-col justify-around gap-3 relative\">\r\n                  <div class=\"text-center mb-2\">\r\n                    <h3 class=\"font-black text-sm text-cyber-blue\">\r\n                      {getRoundLabel(round, totalRounds)}\r\n                    </h3>\r\n                  </div>\r\n                  \r\n                  {#each roundMatches as match, matchIndex}\r\n                    {@const player1 = getPlayer(match.player1Id)}\r\n                    {@const player2 = getPlayer(match.player2Id)}\r\n                    \r\n                    <div class=\"relative\">\r\n                      {#if roundIndex < totalRounds - 1 && match.bracketType !== 'third-place'}\r\n                        <svg class=\"absolute left-full top-1/2 w-4 h-12 -translate-y-1/2 pointer-events-none z-0\" style=\"margin-left: -1px;\">\r\n                          <path d=\"M 0 0 L 16 0\" stroke=\"#334155\" stroke-width=\"1\" fill=\"none\"/>\r\n                        </svg>\r\n                      {/if}\r\n\r\n                      <div class=\"glass rounded-lg overflow-hidden relative z-10\">\r\n                        <div class=\"bg-gradient-to-r from-space-700 to-space-800 px-2 py-1 text-center\">\r\n                          <span class=\"text-xs font-bold text-gray-400\">{match.matchLabel || `M${matchIndex + 1}`}</span>\r\n                        </div>\r\n\r\n                        <!-- Player 1 -->\r\n                        <button \r\n                          type=\"button\"\r\n                          class=\"w-full text-left px-2 py-1.5 border-b border-space-600 transition-all cursor-pointer {match.winnerId === match.player1Id ? 'bg-cyber-green/20 ring-1 ring-cyber-green' : ''} {match.winnerId && match.winnerId !== match.player1Id ? 'opacity-40' : 'hover:bg-space-700/50 hover:ring-1 hover:ring-cyber-green/50'}\"\r\n                          onclick={(e) => { e.stopPropagation(); if (!match.winnerId && match.player1Id) handleWinner(match.id, match.player1Id); }}\r\n                          disabled={!!match.winnerId || !match.player1Id}\r\n                        >\r\n                          <div class=\"flex items-center justify-between\">\r\n                            <div class=\"flex items-center gap-1.5\">\r\n                              <div class=\"w-5 h-5 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center\">\r\n                                <svg class=\"w-3 h-3 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/></svg>\r\n                              </div>\r\n                              <div>\r\n                                <div class=\"font-bold text-xs text-white\">{getPlayerName(match.player1Id)}</div>\r\n                                {#if player1}\r\n                                  <div class=\"text-xs text-gray-400\">{player1.points}pts</div>\r\n                                {/if}\r\n                              </div>\r\n                            </div>\r\n                            {#if match.winnerId === match.player1Id}\r\n                              <svg class=\"w-4 h-4 text-cyber-green\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/></svg>\r\n                            {/if}\r\n                          </div>\r\n                        </button>\r\n                        \r\n                        <!-- Player 2 -->\r\n                        <button \r\n                          type=\"button\"\r\n                          class=\"w-full text-left px-2 py-1.5 transition-all cursor-pointer {match.winnerId === match.player2Id ? 'bg-cyber-green/20 ring-1 ring-cyber-green' : ''} {match.winnerId && match.winnerId !== match.player2Id ? 'opacity-40' : 'hover:bg-space-700/50 hover:ring-1 hover:ring-cyber-green/50'}\"\r\n                          onclick={(e) => { e.stopPropagation(); if (!match.winnerId && match.player2Id) handleWinner(match.id, match.player2Id); }}\r\n                          disabled={!!match.winnerId || !match.player2Id}\r\n                        >\r\n                          <div class=\"flex items-center justify-between\">\r\n                            <div class=\"flex items-center gap-1.5\">\r\n                              <div class=\"w-5 h-5 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center\">\r\n                                <svg class=\"w-3 h-3 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/></svg>\r\n                              </div>\r\n                              <div>\r\n                                <div class=\"font-bold text-xs text-white\">{getPlayerName(match.player2Id)}</div>\r\n                                {#if player2}\r\n                                  <div class=\"text-xs text-gray-400\">{player2.points}pts</div>\r\n                                {/if}\r\n                              </div>\r\n                            </div>\r\n                            {#if match.winnerId === match.player2Id}\r\n                              <svg class=\"w-4 h-4 text-cyber-green\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clip-rule=\"evenodd\"/></svg>\r\n                            {/if}\r\n                          </div>\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  {/each}\r\n                </div>\r\n              {/each}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    {/if}\r\n  </div>\r\n</div>\r\n"
        }
    ]
}