{
    "sourceFile": "src/pages/Statistics.svelte",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1764024886865,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764024901417,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,9 +11,9 @@\n   // Computed statistics\r\n   let playerStats = $derived(() => {\r\n     if (!tournamentData?.players) return [];\r\n \r\n-    return tournamentData.players.map(player => {\r\n+    return tournamentData.players.map((player: any) => {\r\n       const totalGames = player.wins + player.draws + player.losses;\r\n       const winRate = totalGames > 0 ? (player.wins / totalGames) * 100 : 0;\r\n       const avgPoints = totalGames > 0 ? player.points / totalGames : 0;\r\n \r\n@@ -23,9 +23,9 @@\n         winRate: Math.round(winRate * 10) / 10,\r\n         avgPoints: Math.round(avgPoints * 10) / 10,\r\n         performance: player.points + (player.wins * 2) + (player.draws * 1) // Custom performance metric\r\n       };\r\n-    }).sort((a, b) => b.performance - a.performance);\r\n+    }).sort((a: any, b: any) => b.performance - a.performance);\r\n   });\r\n \r\n   let matchStats = $derived(() => {\r\n     if (!tournamentData) return null;\r\n@@ -33,16 +33,16 @@\n     const groupMatches = tournamentData.matches || [];\r\n     const bracketMatches = tournamentData.bracketMatches || [];\r\n \r\n     const totalMatches = groupMatches.length + bracketMatches.length;\r\n-    const completedGroupMatches = groupMatches.filter(m => m.completed).length;\r\n-    const completedBracketMatches = bracketMatches.filter(m => m.winnerId).length;\r\n+    const completedGroupMatches = groupMatches.filter((m: any) => m.completed).length;\r\n+    const completedBracketMatches = bracketMatches.filter((m: any) => m.winnerId).length;\r\n     const totalCompleted = completedGroupMatches + completedBracketMatches;\r\n \r\n     // Calculate win/draw/loss distribution\r\n     let totalWins = 0, totalDraws = 0, totalLosses = 0;\r\n \r\n-    groupMatches.forEach(match => {\r\n+    groupMatches.forEach((match: any) => {\r\n       if (match.result) {\r\n         Object.values(match.result).forEach((result: any) => {\r\n           if (result.points === 3) totalWins++;\r\n           else if (result.points === 1) totalDraws++;\r\n@@ -50,9 +50,9 @@\n         });\r\n       }\r\n     });\r\n \r\n-    bracketMatches.forEach(match => {\r\n+    bracketMatches.forEach((match: any) => {\r\n       if (match.winnerId) totalWins++; // Each bracket match produces one winner\r\n     });\r\n \r\n     return {\r\n@@ -70,13 +70,13 @@\n \r\n   let groupStats = $derived(() => {\r\n     if (!tournamentData?.pods) return [];\r\n \r\n-    return tournamentData.pods.map(pod => {\r\n-      const podMatches = tournamentData.matches.filter(m => m.podId === pod.id);\r\n-      const completedMatches = podMatches.filter(m => m.completed).length;\r\n-      const totalPoints = pod.players.reduce((sum, playerId) => {\r\n-        const player = tournamentData.players.find(p => p.id === playerId);\r\n+    return tournamentData.pods.map((pod: any) => {\r\n+      const podMatches = tournamentData.matches.filter((m: any) => m.podId === pod.id);\r\n+      const completedMatches = podMatches.filter((m: any) => m.completed).length;\r\n+      const totalPoints = pod.players.reduce((sum: number, playerId: string) => {\r\n+        const player = tournamentData.players.find((p: any) => p.id === playerId);\r\n         return sum + (player?.points || 0);\r\n       }, 0);\r\n \r\n       return {\r\n"
                },
                {
                    "date": 1764025099837,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,44 +9,44 @@\n   let error = $state(null) as string | null;\r\n \r\n   // Computed statistics\r\n   let playerStats = $derived(() => {\r\n-    if (!tournamentData?.players) return [];\r\n+    if (!tournamentData?.players || !Array.isArray(tournamentData.players)) return [];\r\n \r\n     return tournamentData.players.map((player: any) => {\r\n-      const totalGames = player.wins + player.draws + player.losses;\r\n-      const winRate = totalGames > 0 ? (player.wins / totalGames) * 100 : 0;\r\n-      const avgPoints = totalGames > 0 ? player.points / totalGames : 0;\r\n+      const totalGames = (player.wins || 0) + (player.draws || 0) + (player.losses || 0);\r\n+      const winRate = totalGames > 0 ? ((player.wins || 0) / totalGames) * 100 : 0;\r\n+      const avgPoints = totalGames > 0 ? (player.points || 0) / totalGames : 0;\r\n \r\n       return {\r\n         ...player,\r\n         totalGames,\r\n         winRate: Math.round(winRate * 10) / 10,\r\n         avgPoints: Math.round(avgPoints * 10) / 10,\r\n-        performance: player.points + (player.wins * 2) + (player.draws * 1) // Custom performance metric\r\n+        performance: (player.points || 0) + ((player.wins || 0) * 2) + (player.draws || 0) // Custom performance metric\r\n       };\r\n-    }).sort((a: any, b: any) => b.performance - a.performance);\r\n+    }).sort((a: any, b: any) => (b.performance || 0) - (a.performance || 0));\r\n   });\r\n \r\n   let matchStats = $derived(() => {\r\n     if (!tournamentData) return null;\r\n \r\n-    const groupMatches = tournamentData.matches || [];\r\n-    const bracketMatches = tournamentData.bracketMatches || [];\r\n+    const groupMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches : [];\r\n+    const bracketMatches = Array.isArray(tournamentData.bracketMatches) ? tournamentData.bracketMatches : [];\r\n \r\n     const totalMatches = groupMatches.length + bracketMatches.length;\r\n-    const completedGroupMatches = groupMatches.filter((m: any) => m.completed).length;\r\n+    const completedGroupMatches = groupMatches.filter((m: any) => m.completed === true).length;\r\n     const completedBracketMatches = bracketMatches.filter((m: any) => m.winnerId).length;\r\n     const totalCompleted = completedGroupMatches + completedBracketMatches;\r\n \r\n     // Calculate win/draw/loss distribution\r\n     let totalWins = 0, totalDraws = 0, totalLosses = 0;\r\n \r\n     groupMatches.forEach((match: any) => {\r\n-      if (match.result) {\r\n+      if (match.result && typeof match.result === 'object') {\r\n         Object.values(match.result).forEach((result: any) => {\r\n-          if (result.points === 3) totalWins++;\r\n-          else if (result.points === 1) totalDraws++;\r\n+          if (result && typeof result === 'object' && result.points === 3) totalWins++;\r\n+          else if (result && typeof result === 'object' && result.points === 1) totalDraws++;\r\n           else totalLosses++;\r\n         });\r\n       }\r\n     });\r\n@@ -68,25 +68,25 @@\n     };\r\n   });\r\n \r\n   let groupStats = $derived(() => {\r\n-    if (!tournamentData?.pods) return [];\r\n+    if (!tournamentData?.pods || !Array.isArray(tournamentData.pods) || !tournamentData.players || !Array.isArray(tournamentData.players)) return [];\r\n \r\n     return tournamentData.pods.map((pod: any) => {\r\n-      const podMatches = tournamentData.matches.filter((m: any) => m.podId === pod.id);\r\n-      const completedMatches = podMatches.filter((m: any) => m.completed).length;\r\n-      const totalPoints = pod.players.reduce((sum: number, playerId: string) => {\r\n+      const podMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches.filter((m: any) => m.podId === pod.id) : [];\r\n+      const completedMatches = podMatches.filter((m: any) => m.completed === true).length;\r\n+      const totalPoints = Array.isArray(pod.players) ? pod.players.reduce((sum: number, playerId: string) => {\r\n         const player = tournamentData.players.find((p: any) => p.id === playerId);\r\n         return sum + (player?.points || 0);\r\n-      }, 0);\r\n+      }, 0) : 0;\r\n \r\n       return {\r\n         ...pod,\r\n         totalMatches: podMatches.length,\r\n         completedMatches,\r\n         completionRate: podMatches.length > 0 ? Math.round((completedMatches / podMatches.length) * 100) : 0,\r\n         totalPoints,\r\n-        avgPoints: pod.players.length > 0 ? Math.round(totalPoints / pod.players.length * 10) / 10 : 0\r\n+        avgPoints: Array.isArray(pod.players) && pod.players.length > 0 ? Math.round(totalPoints / pod.players.length * 10) / 10 : 0\r\n       };\r\n     });\r\n   });\r\n \r\n@@ -97,12 +97,12 @@\n     const currentTime = new Date();\r\n     const duration = Math.floor((currentTime.getTime() - startTime.getTime()) / (1000 * 60)); // minutes\r\n \r\n     return {\r\n-      name: tournamentData.name,\r\n-      state: tournamentData.state,\r\n-      playerCount: tournamentData.players?.length || 0,\r\n-      groupCount: tournamentData.pods?.length || 0,\r\n+      name: tournamentData.name || 'Unknown Tournament',\r\n+      state: tournamentData.state || 'unknown',\r\n+      playerCount: Array.isArray(tournamentData.players) ? tournamentData.players.length : 0,\r\n+      groupCount: Array.isArray(tournamentData.pods) ? tournamentData.pods.length : 0,\r\n       duration: `${duration} minutes`,\r\n       isCompleted: tournamentData.state === 'completed'\r\n     };\r\n   });\r\n"
                },
                {
                    "date": 1764025277614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,105 +7,119 @@\n   let tournamentData = $state(null) as any;\r\n   let loading = $state(true);\r\n   let error = $state(null) as string | null;\r\n \r\n-  // Computed statistics\r\n-  let playerStats = $derived(() => {\r\n-    if (!tournamentData?.players || !Array.isArray(tournamentData.players)) return [];\r\n+  // Reactive statements to compute statistics\r\n+  let playerStats: any[] = $state([]);\r\n+  let matchStats: any = $state(null);\r\n+  let groupStats: any[] = $state([]);\r\n+  let tournamentOverview: any = $state(null);\r\n \r\n-    return tournamentData.players.map((player: any) => {\r\n-      const totalGames = (player.wins || 0) + (player.draws || 0) + (player.losses || 0);\r\n-      const winRate = totalGames > 0 ? ((player.wins || 0) / totalGames) * 100 : 0;\r\n-      const avgPoints = totalGames > 0 ? (player.points || 0) / totalGames : 0;\r\n+  // Update computed values when tournamentData changes\r\n+  $effect(() => {\r\n+    if (tournamentData?.players && Array.isArray(tournamentData.players)) {\r\n+      playerStats = tournamentData.players.map((player: any) => {\r\n+        const totalGames = (player.wins || 0) + (player.draws || 0) + (player.losses || 0);\r\n+        const winRate = totalGames > 0 ? ((player.wins || 0) / totalGames) * 100 : 0;\r\n+        const avgPoints = totalGames > 0 ? (player.points || 0) / totalGames : 0;\r\n \r\n-      return {\r\n-        ...player,\r\n-        totalGames,\r\n-        winRate: Math.round(winRate * 10) / 10,\r\n-        avgPoints: Math.round(avgPoints * 10) / 10,\r\n-        performance: (player.points || 0) + ((player.wins || 0) * 2) + (player.draws || 0) // Custom performance metric\r\n-      };\r\n-    }).sort((a: any, b: any) => (b.performance || 0) - (a.performance || 0));\r\n+        return {\r\n+          ...player,\r\n+          totalGames,\r\n+          winRate: Math.round(winRate * 10) / 10,\r\n+          avgPoints: Math.round(avgPoints * 10) / 10,\r\n+          performance: (player.points || 0) + ((player.wins || 0) * 2) + (player.draws || 0) // Custom performance metric\r\n+        };\r\n+      }).sort((a: any, b: any) => (b.performance || 0) - (a.performance || 0));\r\n+    } else {\r\n+      playerStats = [];\r\n+    }\r\n   });\r\n \r\n-  let matchStats = $derived(() => {\r\n-    if (!tournamentData) return null;\r\n+  $effect(() => {\r\n+    if (tournamentData) {\r\n+      const groupMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches : [];\r\n+      const bracketMatches = Array.isArray(tournamentData.bracketMatches) ? tournamentData.bracketMatches : [];\r\n \r\n-    const groupMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches : [];\r\n-    const bracketMatches = Array.isArray(tournamentData.bracketMatches) ? tournamentData.bracketMatches : [];\r\n+      const totalMatches = groupMatches.length + bracketMatches.length;\r\n+      const completedGroupMatches = groupMatches.filter((m: any) => m.completed === true).length;\r\n+      const completedBracketMatches = bracketMatches.filter((m: any) => m.winnerId).length;\r\n+      const totalCompleted = completedGroupMatches + completedBracketMatches;\r\n \r\n-    const totalMatches = groupMatches.length + bracketMatches.length;\r\n-    const completedGroupMatches = groupMatches.filter((m: any) => m.completed === true).length;\r\n-    const completedBracketMatches = bracketMatches.filter((m: any) => m.winnerId).length;\r\n-    const totalCompleted = completedGroupMatches + completedBracketMatches;\r\n+      // Calculate win/draw/loss distribution\r\n+      let totalWins = 0, totalDraws = 0, totalLosses = 0;\r\n \r\n-    // Calculate win/draw/loss distribution\r\n-    let totalWins = 0, totalDraws = 0, totalLosses = 0;\r\n+      groupMatches.forEach((match: any) => {\r\n+        if (match.result && typeof match.result === 'object') {\r\n+          Object.values(match.result).forEach((result: any) => {\r\n+            if (result && typeof result === 'object' && result.points === 3) totalWins++;\r\n+            else if (result && typeof result === 'object' && result.points === 1) totalDraws++;\r\n+            else totalLosses++;\r\n+          });\r\n+        }\r\n+      });\r\n \r\n-    groupMatches.forEach((match: any) => {\r\n-      if (match.result && typeof match.result === 'object') {\r\n-        Object.values(match.result).forEach((result: any) => {\r\n-          if (result && typeof result === 'object' && result.points === 3) totalWins++;\r\n-          else if (result && typeof result === 'object' && result.points === 1) totalDraws++;\r\n-          else totalLosses++;\r\n-        });\r\n-      }\r\n-    });\r\n+      bracketMatches.forEach((match: any) => {\r\n+        if (match.winnerId) totalWins++; // Each bracket match produces one winner\r\n+      });\r\n \r\n-    bracketMatches.forEach((match: any) => {\r\n-      if (match.winnerId) totalWins++; // Each bracket match produces one winner\r\n-    });\r\n-\r\n-    return {\r\n-      totalMatches,\r\n-      completedMatches: totalCompleted,\r\n-      completionRate: totalMatches > 0 ? Math.round((totalCompleted / totalMatches) * 100) : 0,\r\n-      groupMatches: groupMatches.length,\r\n-      bracketMatches: bracketMatches.length,\r\n-      totalWins,\r\n-      totalDraws,\r\n-      totalLosses,\r\n-      avgPointsPerMatch: totalMatches > 0 ? Math.round((totalWins * 3 + totalDraws * 1) / totalMatches * 10) / 10 : 0\r\n-    };\r\n+      matchStats = {\r\n+        totalMatches,\r\n+        completedMatches: totalCompleted,\r\n+        completionRate: totalMatches > 0 ? Math.round((totalCompleted / totalMatches) * 100) : 0,\r\n+        groupMatches: groupMatches.length,\r\n+        bracketMatches: bracketMatches.length,\r\n+        totalWins,\r\n+        totalDraws,\r\n+        totalLosses,\r\n+        avgPointsPerMatch: totalMatches > 0 ? Math.round((totalWins * 3 + totalDraws * 1) / totalMatches * 10) / 10 : 0\r\n+      };\r\n+    } else {\r\n+      matchStats = null;\r\n+    }\r\n   });\r\n \r\n-  let groupStats = $derived(() => {\r\n-    if (!tournamentData?.pods || !Array.isArray(tournamentData.pods) || !tournamentData.players || !Array.isArray(tournamentData.players)) return [];\r\n+  $effect(() => {\r\n+    if (tournamentData?.pods && Array.isArray(tournamentData.pods) && tournamentData.players && Array.isArray(tournamentData.players)) {\r\n+      groupStats = tournamentData.pods.map((pod: any) => {\r\n+        const podMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches.filter((m: any) => m.podId === pod.id) : [];\r\n+        const completedMatches = podMatches.filter((m: any) => m.completed === true).length;\r\n+        const totalPoints = Array.isArray(pod.players) ? pod.players.reduce((sum: number, playerId: string) => {\r\n+          const player = tournamentData.players.find((p: any) => p.id === playerId);\r\n+          return sum + (player?.points || 0);\r\n+        }, 0) : 0;\r\n \r\n-    return tournamentData.pods.map((pod: any) => {\r\n-      const podMatches = Array.isArray(tournamentData.matches) ? tournamentData.matches.filter((m: any) => m.podId === pod.id) : [];\r\n-      const completedMatches = podMatches.filter((m: any) => m.completed === true).length;\r\n-      const totalPoints = Array.isArray(pod.players) ? pod.players.reduce((sum: number, playerId: string) => {\r\n-        const player = tournamentData.players.find((p: any) => p.id === playerId);\r\n-        return sum + (player?.points || 0);\r\n-      }, 0) : 0;\r\n-\r\n-      return {\r\n-        ...pod,\r\n-        totalMatches: podMatches.length,\r\n-        completedMatches,\r\n-        completionRate: podMatches.length > 0 ? Math.round((completedMatches / podMatches.length) * 100) : 0,\r\n-        totalPoints,\r\n-        avgPoints: Array.isArray(pod.players) && pod.players.length > 0 ? Math.round(totalPoints / pod.players.length * 10) / 10 : 0\r\n-      };\r\n-    });\r\n+        return {\r\n+          ...pod,\r\n+          totalMatches: podMatches.length,\r\n+          completedMatches,\r\n+          completionRate: podMatches.length > 0 ? Math.round((completedMatches / podMatches.length) * 100) : 0,\r\n+          totalPoints,\r\n+          avgPoints: Array.isArray(pod.players) && pod.players.length > 0 ? Math.round(totalPoints / pod.players.length * 10) / 10 : 0\r\n+        };\r\n+      });\r\n+    } else {\r\n+      groupStats = [];\r\n+    }\r\n   });\r\n \r\n-  let tournamentOverview = $derived(() => {\r\n-    if (!tournamentData) return null;\r\n+  $effect(() => {\r\n+    if (tournamentData) {\r\n+      const startTime = new Date(); // Would need to be stored in tournament data\r\n+      const currentTime = new Date();\r\n+      const duration = Math.floor((currentTime.getTime() - startTime.getTime()) / (1000 * 60)); // minutes\r\n \r\n-    const startTime = new Date(); // Would need to be stored in tournament data\r\n-    const currentTime = new Date();\r\n-    const duration = Math.floor((currentTime.getTime() - startTime.getTime()) / (1000 * 60)); // minutes\r\n-\r\n-    return {\r\n-      name: tournamentData.name || 'Unknown Tournament',\r\n-      state: tournamentData.state || 'unknown',\r\n-      playerCount: Array.isArray(tournamentData.players) ? tournamentData.players.length : 0,\r\n-      groupCount: Array.isArray(tournamentData.pods) ? tournamentData.pods.length : 0,\r\n-      duration: `${duration} minutes`,\r\n-      isCompleted: tournamentData.state === 'completed'\r\n-    };\r\n+      tournamentOverview = {\r\n+        name: tournamentData.name || 'Unknown Tournament',\r\n+        state: tournamentData.state || 'unknown',\r\n+        playerCount: Array.isArray(tournamentData.players) ? tournamentData.players.length : 0,\r\n+        groupCount: Array.isArray(tournamentData.pods) ? tournamentData.pods.length : 0,\r\n+        duration: `${duration} minutes`,\r\n+        isCompleted: tournamentData.state === 'completed'\r\n+      };\r\n+    } else {\r\n+      tournamentOverview = null;\r\n+    }\r\n   });\r\n \r\n   async function loadTournamentData() {\r\n     try {\r\n"
                },
                {
                    "date": 1764028191892,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -268,8 +268,19 @@\n                  'bg-space-600 text-gray-400'}\">\r\n                 {index + 1}\r\n               </div>\r\n \r\n+              <!-- Player Avatar -->\r\n+              <div class=\"w-10 h-10 rounded-full flex items-center justify-center\">\r\n+                {#if player.profilePhoto}\r\n+                  <img src={player.profilePhoto} alt=\"Profile\" class=\"w-10 h-10 rounded-full object-cover\" />\r\n+                {:else}\r\n+                  <div class=\"w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center\">\r\n+                    <svg class=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/></svg>\r\n+                  </div>\r\n+                {/if}\r\n+              </div>\r\n+\r\n               <!-- Player Info -->\r\n               <div class=\"flex-1\">\r\n                 <div class=\"font-bold text-white\">{player.name}</div>\r\n                 <div class=\"text-xs text-gray-400\">\r\n"
                }
            ],
            "date": 1764024886865,
            "name": "Commit-0",
            "content": "<script lang=\"ts\">\r\n  import { onMount } from 'svelte';\r\n  import { getState } from '$lib/api';\r\n\r\n  let { tournamentId } = $props<{ tournamentId: string }>();\r\n\r\n  let tournamentData = $state(null) as any;\r\n  let loading = $state(true);\r\n  let error = $state(null) as string | null;\r\n\r\n  // Computed statistics\r\n  let playerStats = $derived(() => {\r\n    if (!tournamentData?.players) return [];\r\n\r\n    return tournamentData.players.map(player => {\r\n      const totalGames = player.wins + player.draws + player.losses;\r\n      const winRate = totalGames > 0 ? (player.wins / totalGames) * 100 : 0;\r\n      const avgPoints = totalGames > 0 ? player.points / totalGames : 0;\r\n\r\n      return {\r\n        ...player,\r\n        totalGames,\r\n        winRate: Math.round(winRate * 10) / 10,\r\n        avgPoints: Math.round(avgPoints * 10) / 10,\r\n        performance: player.points + (player.wins * 2) + (player.draws * 1) // Custom performance metric\r\n      };\r\n    }).sort((a, b) => b.performance - a.performance);\r\n  });\r\n\r\n  let matchStats = $derived(() => {\r\n    if (!tournamentData) return null;\r\n\r\n    const groupMatches = tournamentData.matches || [];\r\n    const bracketMatches = tournamentData.bracketMatches || [];\r\n\r\n    const totalMatches = groupMatches.length + bracketMatches.length;\r\n    const completedGroupMatches = groupMatches.filter(m => m.completed).length;\r\n    const completedBracketMatches = bracketMatches.filter(m => m.winnerId).length;\r\n    const totalCompleted = completedGroupMatches + completedBracketMatches;\r\n\r\n    // Calculate win/draw/loss distribution\r\n    let totalWins = 0, totalDraws = 0, totalLosses = 0;\r\n\r\n    groupMatches.forEach(match => {\r\n      if (match.result) {\r\n        Object.values(match.result).forEach((result: any) => {\r\n          if (result.points === 3) totalWins++;\r\n          else if (result.points === 1) totalDraws++;\r\n          else totalLosses++;\r\n        });\r\n      }\r\n    });\r\n\r\n    bracketMatches.forEach(match => {\r\n      if (match.winnerId) totalWins++; // Each bracket match produces one winner\r\n    });\r\n\r\n    return {\r\n      totalMatches,\r\n      completedMatches: totalCompleted,\r\n      completionRate: totalMatches > 0 ? Math.round((totalCompleted / totalMatches) * 100) : 0,\r\n      groupMatches: groupMatches.length,\r\n      bracketMatches: bracketMatches.length,\r\n      totalWins,\r\n      totalDraws,\r\n      totalLosses,\r\n      avgPointsPerMatch: totalMatches > 0 ? Math.round((totalWins * 3 + totalDraws * 1) / totalMatches * 10) / 10 : 0\r\n    };\r\n  });\r\n\r\n  let groupStats = $derived(() => {\r\n    if (!tournamentData?.pods) return [];\r\n\r\n    return tournamentData.pods.map(pod => {\r\n      const podMatches = tournamentData.matches.filter(m => m.podId === pod.id);\r\n      const completedMatches = podMatches.filter(m => m.completed).length;\r\n      const totalPoints = pod.players.reduce((sum, playerId) => {\r\n        const player = tournamentData.players.find(p => p.id === playerId);\r\n        return sum + (player?.points || 0);\r\n      }, 0);\r\n\r\n      return {\r\n        ...pod,\r\n        totalMatches: podMatches.length,\r\n        completedMatches,\r\n        completionRate: podMatches.length > 0 ? Math.round((completedMatches / podMatches.length) * 100) : 0,\r\n        totalPoints,\r\n        avgPoints: pod.players.length > 0 ? Math.round(totalPoints / pod.players.length * 10) / 10 : 0\r\n      };\r\n    });\r\n  });\r\n\r\n  let tournamentOverview = $derived(() => {\r\n    if (!tournamentData) return null;\r\n\r\n    const startTime = new Date(); // Would need to be stored in tournament data\r\n    const currentTime = new Date();\r\n    const duration = Math.floor((currentTime.getTime() - startTime.getTime()) / (1000 * 60)); // minutes\r\n\r\n    return {\r\n      name: tournamentData.name,\r\n      state: tournamentData.state,\r\n      playerCount: tournamentData.players?.length || 0,\r\n      groupCount: tournamentData.pods?.length || 0,\r\n      duration: `${duration} minutes`,\r\n      isCompleted: tournamentData.state === 'completed'\r\n    };\r\n  });\r\n\r\n  async function loadTournamentData() {\r\n    try {\r\n      loading = true;\r\n      error = null;\r\n      tournamentData = await getState(tournamentId);\r\n    } catch (err) {\r\n      error = err instanceof Error ? err.message : 'Failed to load tournament data';\r\n      console.error('Error loading tournament data:', err);\r\n    } finally {\r\n      loading = false;\r\n    }\r\n  }\r\n\r\n  onMount(loadTournamentData);\r\n</script>\r\n\r\n<div class=\"min-h-screen bg-gradient-to-br from-space-900 via-space-800 to-space-900 text-gaming-text px-3 py-3\">\r\n  <div class=\"max-w-7xl mx-auto\">\r\n\r\n    <!-- Header -->\r\n    <div class=\"flex justify-between items-center mb-6\">\r\n      <div>\r\n        <a href={`/tournament/${tournamentId}`} class=\"text-gray-400 hover:text-cyber-green transition-colors mb-1 inline-block text-xs flex items-center gap-1\">\r\n          <svg class=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"/></svg>\r\n          Back to Dashboard\r\n        </a>\r\n        <h1 class=\"text-2xl font-black gradient-text flex items-center gap-2\">\r\n          <svg class=\"w-6 h-6 text-cyber-blue\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"/>\r\n          </svg>\r\n          TOURNAMENT STATISTICS\r\n        </h1>\r\n      </div>\r\n    </div>\r\n\r\n    {#if loading}\r\n      <div class=\"flex justify-center items-center py-20\">\r\n        <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 border-cyber-green\"></div>\r\n      </div>\r\n    {:else if error}\r\n      <div class=\"glass rounded-lg p-6 text-center\">\r\n        <svg class=\"w-12 h-12 mx-auto mb-3 text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        <p class=\"text-red-400 font-bold\">Error loading statistics</p>\r\n        <p class=\"text-gray-400 text-sm mt-1\">{error}</p>\r\n      </div>\r\n    {:else if tournamentData}\r\n\r\n      <!-- Tournament Overview -->\r\n      {#if tournamentOverview}\r\n        {@const overview = tournamentOverview}\r\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\r\n          <div class=\"glass rounded-lg p-4 text-center\">\r\n            <div class=\"text-2xl font-black text-cyber-green mb-1\">{overview.playerCount}</div>\r\n            <div class=\"text-xs text-gray-400 uppercase tracking-wide\">Total Players</div>\r\n          </div>\r\n          <div class=\"glass rounded-lg p-4 text-center\">\r\n            <div class=\"text-2xl font-black text-cyber-blue mb-1\">{overview.groupCount}</div>\r\n            <div class=\"text-xs text-gray-400 uppercase tracking-wide\">Groups</div>\r\n          </div>\r\n          <div class=\"glass rounded-lg p-4 text-center\">\r\n            <div class=\"text-2xl font-black text-cyber-pink mb-1\">{overview.state}</div>\r\n            <div class=\"text-xs text-gray-400 uppercase tracking-wide\">Current Phase</div>\r\n          </div>\r\n          <div class=\"glass rounded-lg p-4 text-center\">\r\n            <div class=\"text-2xl font-black text-yellow-400 mb-1\">{matchStats?.completionRate || 0}%</div>\r\n            <div class=\"text-xs text-gray-400 uppercase tracking-wide\">Complete</div>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Match Statistics -->\r\n      {#if matchStats}\r\n        {@const stats = matchStats}\r\n        <div class=\"glass rounded-lg p-6 mb-6\">\r\n          <h2 class=\"text-xl font-bold mb-4 text-white flex items-center gap-2\">\r\n            <svg class=\"w-5 h-5 text-cyber-green\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"/>\r\n            </svg>\r\n            Match Statistics\r\n          </h2>\r\n\r\n          <div class=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\r\n            <div class=\"text-center\">\r\n              <div class=\"text-3xl font-black text-cyber-green\">{stats.totalMatches}</div>\r\n              <div class=\"text-xs text-gray-400\">Total Matches</div>\r\n            </div>\r\n            <div class=\"text-center\">\r\n              <div class=\"text-3xl font-black text-cyber-blue\">{stats.completedMatches}</div>\r\n              <div class=\"text-xs text-gray-400\">Completed</div>\r\n            </div>\r\n            <div class=\"text-center\">\r\n              <div class=\"text-3xl font-black text-cyber-pink\">{stats.groupMatches}</div>\r\n              <div class=\"text-xs text-gray-400\">Group Stage</div>\r\n            </div>\r\n            <div class=\"text-center\">\r\n              <div class=\"text-3xl font-black text-yellow-400\">{stats.bracketMatches}</div>\r\n              <div class=\"text-xs text-gray-400\">Playoffs</div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Win/Loss/Draw Distribution -->\r\n          <div class=\"mb-4\">\r\n            <h3 class=\"text-sm font-bold text-gray-300 mb-2\">Match Outcomes</h3>\r\n            <div class=\"flex gap-2\">\r\n              <div class=\"flex-1 bg-green-900/30 rounded p-2 text-center\">\r\n                <div class=\"text-lg font-bold text-green-400\">{stats.totalWins}</div>\r\n                <div class=\"text-xs text-gray-400\">Wins</div>\r\n              </div>\r\n              <div class=\"flex-1 bg-yellow-900/30 rounded p-2 text-center\">\r\n                <div class=\"text-lg font-bold text-yellow-400\">{stats.totalDraws}</div>\r\n                <div class=\"text-xs text-gray-400\">Draws</div>\r\n              </div>\r\n              <div class=\"flex-1 bg-red-900/30 rounded p-2 text-center\">\r\n                <div class=\"text-lg font-bold text-red-400\">{stats.totalLosses}</div>\r\n                <div class=\"text-xs text-gray-400\">Losses</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"text-center text-sm text-gray-400\">\r\n            Average Points per Match: <span class=\"text-cyber-green font-bold\">{stats.avgPointsPerMatch}</span>\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Player Performance Rankings -->\r\n      <div class=\"glass rounded-lg p-6 mb-6\">\r\n        <h2 class=\"text-xl font-bold mb-4 text-white flex items-center gap-2\">\r\n          <svg class=\"w-5 h-5 text-cyber-blue\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n          </svg>\r\n          Player Performance Rankings\r\n        </h2>\r\n\r\n        <div class=\"space-y-2\">\r\n          {#each playerStats as player, index}\r\n            <div class=\"flex items-center gap-4 p-3 rounded-lg bg-space-700/50 hover:bg-space-700 transition-colors\">\r\n              <!-- Rank -->\r\n              <div class=\"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm\r\n                {index === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600 text-space-900' :\r\n                 index === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-500 text-space-900' :\r\n                 index === 2 ? 'bg-gradient-to-br from-orange-400 to-orange-600 text-space-900' :\r\n                 'bg-space-600 text-gray-400'}\">\r\n                {index + 1}\r\n              </div>\r\n\r\n              <!-- Player Info -->\r\n              <div class=\"flex-1\">\r\n                <div class=\"font-bold text-white\">{player.name}</div>\r\n                <div class=\"text-xs text-gray-400\">\r\n                  {player.totalGames} games ‚Ä¢ {player.wins}W {player.draws}D {player.losses}L\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Stats -->\r\n              <div class=\"text-right\">\r\n                <div class=\"text-lg font-black text-cyber-green\">{player.points}</div>\r\n                <div class=\"text-xs text-gray-400\">Points</div>\r\n              </div>\r\n\r\n              <div class=\"text-right\">\r\n                <div class=\"text-lg font-black text-cyber-blue\">{player.winRate}%</div>\r\n                <div class=\"text-xs text-gray-400\">Win Rate</div>\r\n              </div>\r\n\r\n              <div class=\"text-right\">\r\n                <div class=\"text-lg font-black text-cyber-pink\">{player.avgPoints}</div>\r\n                <div class=\"text-xs text-gray-400\">Avg Pts</div>\r\n              </div>\r\n            </div>\r\n          {/each}\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Group Performance -->\r\n      {#if groupStats.length > 0}\r\n        <div class=\"glass rounded-lg p-6 mb-6\">\r\n          <h2 class=\"text-xl font-bold mb-4 text-white flex items-center gap-2\">\r\n            <svg class=\"w-5 h-5 text-purple-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\r\n            </svg>\r\n            Group Performance\r\n          </h2>\r\n\r\n          <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {#each groupStats as group}\r\n              <div class=\"bg-space-700/50 rounded-lg p-4\">\r\n                <div class=\"flex justify-between items-start mb-2\">\r\n                  <h3 class=\"font-bold text-white\">{group.name || `Group ${group.id.slice(-1)}`}</h3>\r\n                  <div class=\"text-sm text-gray-400\">{group.players.length} players</div>\r\n                </div>\r\n\r\n                <div class=\"grid grid-cols-3 gap-2 text-center\">\r\n                  <div>\r\n                    <div class=\"text-lg font-bold text-cyber-green\">{group.totalMatches}</div>\r\n                    <div class=\"text-xs text-gray-400\">Matches</div>\r\n                  </div>\r\n                  <div>\r\n                    <div class=\"text-lg font-bold text-cyber-blue\">{group.completedMatches}</div>\r\n                    <div class=\"text-xs text-gray-400\">Completed</div>\r\n                  </div>\r\n                  <div>\r\n                    <div class=\"text-lg font-bold text-cyber-pink\">{group.avgPoints}</div>\r\n                    <div class=\"text-xs text-gray-400\">Avg Pts</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Progress Bar -->\r\n                <div class=\"mt-3\">\r\n                  <div class=\"flex justify-between text-xs text-gray-400 mb-1\">\r\n                    <span>Progress</span>\r\n                    <span>{group.completionRate}%</span>\r\n                  </div>\r\n                  <div class=\"w-full bg-space-600 rounded-full h-2\">\r\n                    <div\r\n                      class=\"bg-gradient-to-r from-cyber-green to-cyber-blue h-2 rounded-full transition-all duration-300\"\r\n                      style=\"width: {group.completionRate}%\"\r\n                    ></div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            {/each}\r\n          </div>\r\n        </div>\r\n      {/if}\r\n\r\n      <!-- Tournament Timeline -->\r\n      <div class=\"glass rounded-lg p-6\">\r\n        <h2 class=\"text-xl font-bold mb-4 text-white flex items-center gap-2\">\r\n          <svg class=\"w-5 h-5 text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n          </svg>\r\n          Tournament Timeline\r\n        </h2>\r\n\r\n        <div class=\"space-y-4\">\r\n          <!-- Registration Phase -->\r\n          <div class=\"flex items-center gap-4\">\r\n            <div class=\"w-4 h-4 rounded-full bg-cyber-green flex-shrink-0\"></div>\r\n            <div class=\"flex-1\">\r\n              <div class=\"font-bold text-white\">Registration Phase</div>\r\n              <div class=\"text-sm text-gray-400\">\r\n                {tournamentData.players?.length || 0} players registered\r\n                {#if tournamentData.state === 'registration'}\r\n                  <span class=\"text-cyber-green font-bold\">(Current Phase)</span>\r\n                {/if}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Group Stage -->\r\n          <div class=\"flex items-center gap-4\">\r\n            <div class=\"w-4 h-4 rounded-full\r\n              {tournamentData.state === 'group' || tournamentData.state === 'playoffs' || tournamentData.state === 'completed' ?\r\n                'bg-cyber-blue' : 'bg-gray-600'} flex-shrink-0\"></div>\r\n            <div class=\"flex-1\">\r\n              <div class=\"font-bold text-white\">Group Stage</div>\r\n              <div class=\"text-sm text-gray-400\">\r\n                {tournamentData.matches?.filter(m => m.completed).length || 0} of {tournamentData.matches?.length || 0} matches completed\r\n                {#if tournamentData.state === 'group'}\r\n                  <span class=\"text-cyber-blue font-bold\">(Current Phase)</span>\r\n                {/if}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Playoffs -->\r\n          <div class=\"flex items-center gap-4\">\r\n            <div class=\"w-4 h-4 rounded-full\r\n              {tournamentData.state === 'playoffs' || tournamentData.state === 'completed' ?\r\n                'bg-cyber-pink' : 'bg-gray-600'} flex-shrink-0\"></div>\r\n            <div class=\"flex-1\">\r\n              <div class=\"font-bold text-white\">Playoffs</div>\r\n              <div class=\"text-sm text-gray-400\">\r\n                {tournamentData.bracketMatches?.filter(m => m.winnerId).length || 0} of {tournamentData.bracketMatches?.length || 0} matches completed\r\n                {#if tournamentData.state === 'playoffs'}\r\n                  <span class=\"text-cyber-pink font-bold\">(Current Phase)</span>\r\n                {/if}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Completion -->\r\n          <div class=\"flex items-center gap-4\">\r\n            <div class=\"w-4 h-4 rounded-full\r\n              {tournamentData.state === 'completed' ? 'bg-yellow-400' : 'bg-gray-600'} flex-shrink-0\"></div>\r\n            <div class=\"flex-1\">\r\n              <div class=\"font-bold text-white\">Tournament Complete</div>\r\n              <div class=\"text-sm text-gray-400\">\r\n                {#if tournamentData.state === 'completed'}\r\n                  <span class=\"text-yellow-400 font-bold\">üèÜ Champion crowned!</span>\r\n                {:else}\r\n                  Not yet completed\r\n                {/if}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    {/if}\r\n  </div>\r\n</div>\r\n"
        }
    ]
}